<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Puisi Romantis Anonim</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gradient-to-r from-pink-800 via-purple-900 to-indigo-900 min-h-screen text-white">
  <div class="max-w-lg mx-auto mt-10 p-6 bg-gray-900 rounded-xl shadow-lg">
    <h1 class="text-3xl font-bold mb-6 text-center">Puisi Romantis Anonim</h1>
    
    <form id="puisiForm">
      <div class="mb-4">
        <label for="target" class="block font-semibold">Nama Target</label>
        <input type="text" id="target" required placeholder="Contoh: Ayang"
               class="w-full mt-1 p-2 bg-gray-700 rounded-md focus:ring-2 focus:ring-pink-500 outline-none"/>
      </div>

      <div class="mb-4">
        <label for="jumlah" class="block font-semibold">Jumlah Pesan</label>
        <input type="number" id="jumlah" min="1" required placeholder="Contoh: 5"
               class="w-full mt-1 p-2 bg-gray-700 rounded-md focus:ring-2 focus:ring-pink-500 outline-none"/>
      </div>

      <div class="mb-4">
        <span class="block font-semibold mb-1">Mode</span>
        <label class="inline-flex items-center mr-4">
          <input type="radio" name="mode" value="puisi" checked class="form-radio text-pink-500" />
          <span class="ml-2">Puisi</span>
        </label>
        <label class="inline-flex items-center">
          <input type="radio" name="mode" value="kostum" class="form-radio text-pink-500" />
          <span class="ml-2">Kostum</span>
        </label>
      </div>

      <div class="mb-4 hidden" id="kostumWrapper">
        <label for="kostumPesan" class="block font-semibold">Isi Pesan Kostum</label>
        <textarea id="kostumPesan" rows="4" placeholder="Tulis pesan Anda..."
                  class="w-full mt-1 p-2 bg-gray-700 rounded-md focus:ring-2 focus:ring-pink-500 outline-none"></textarea>
      </div>

      <button type="submit" class="w-full py-2 bg-pink-600 hover:bg-pink-700 rounded-md font-bold transition">
        Kirim Pesan
      </button>
    </form>
  </div>

  <script>
    const puisiList = [
      "Namamu seperti adzan, menenangkan tiap malamku.",
      "Cintaku padamu seperti skripsi, tak selesai-selesai.",
      "Setiap kamu senyum, semesta ikut bahagia.",
      "Kalau kamu bintang, aku langitnya.",
      "Kamu seperti kopi, pahit tapi bikin candu.",
      "Aku nggak pintar matematika, tapi tahu kita cocok.",
      "Dunia ini indah, tapi lebih indah kalau bersamamu.",
      "Kalau kamu hujan, aku rela basah.",
      "Aku mau jadi alasan kamu bahagia, bukan galau.",
      "Kalau cinta ini salah, aku rela nggak bener."
    ];

    document.querySelectorAll('input[name="mode"]').forEach(el => {
      el.addEventListener('change', function () {
        document.getElementById('kostumWrapper').classList.toggle('hidden', this.value !== 'kostum');
      });
    });

    document.getElementById('puisiForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const target = document.getElementById('target').value.trim();
      const jumlah = parseInt(document.getElementById('jumlah').value);
      const mode = document.querySelector('input[name="mode"]:checked').value;
      const kostumPesan = document.getElementById('kostumPesan').value.trim();

      if (!target || isNaN(jumlah) || jumlah < 1) {
        return Swal.fire("Error", "Semua kolom harus diisi dengan benar", "error");
      }

      Swal.fire({
        title: "Mengirim...",
        html: `Mengirim ${jumlah} pesan ke <b>${target}</b><br><small>Delay acak tiap 1-2 detik</small>`,
        allowOutsideClick: false,
        didOpen: () => Swal.showLoading()
      });

      let sukses = 0, gagal = 0;

      for (let i = 0; i < jumlah; i++) {
        const message = mode === 'kostum' ? kostumPesan : puisiList[Math.floor(Math.random() * puisiList.length)].replace("kamu", target);
        try {
          const res = await fetch("/api", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username: target, message })
          });

          res.ok ? sukses++ : gagal++;
        } catch {
          gagal++;
        }

        await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 1000)); // 1-2 detik
      }

      Swal.fire("Selesai!", `Berhasil: ${sukses}, Gagal: ${gagal}`, "success");
    });
  </script>
</body>
</html>
